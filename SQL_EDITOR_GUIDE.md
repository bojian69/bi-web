# 🚀 高级SQL查询编辑器使用指南

## 📋 概述

bi-web平台现已升级为双编辑器架构，提供**高级编辑器**和**基础编辑器**两种选择，满足不同用户的需求。

## ✨ 编辑器特性对比

| 功能特性 | 高级编辑器 | 基础编辑器 |
|---------|-----------|-----------|
| 🎨 语法高亮 | ✅ 完整SQL语法高亮 | ✅ 基础高亮 |
| 💡 智能提示 | ✅ 关键字、函数、表名、列名 | ❌ |
| 📝 代码片段 | ✅ 丰富的SQL模板 | ❌ |
| 🔧 自动格式化 | ✅ 智能SQL格式化 | ✅ 基础格式化 |
| 🔍 语法检查 | ✅ 实时错误检测 | ❌ |
| 📊 查询统计 | ✅ 复杂度分析 | ❌ |
| ⌨️ 快捷键 | ✅ VS Code风格 | ✅ 基础快捷键 |
| 🖱️ 多光标编辑 | ✅ | ❌ |
| 🔄 撤销重做 | ✅ 无限历史 | ✅ 基础历史 |
| 📱 移动端适配 | ✅ 响应式设计 | ✅ |

## 🎯 高级编辑器功能详解

### 💡 智能代码提示

#### 关键字提示
- 自动提示SQL关键字：`SELECT`, `FROM`, `WHERE`, `JOIN`等
- 上下文感知：在不同位置提供相应的关键字建议

#### 函数提示
- 内置函数：`COUNT()`, `SUM()`, `AVG()`, `MAX()`, `MIN()`
- 字符串函数：`CONCAT()`, `SUBSTRING()`, `LENGTH()`
- 日期函数：`NOW()`, `DATE()`, `YEAR()`, `MONTH()`
- 数学函数：`ABS()`, `ROUND()`, `CEIL()`, `FLOOR()`

#### 代码片段模板
- **select-basic**: 基础SELECT查询模板
- **select-join**: JOIN查询模板
- **select-group**: GROUP BY查询模板
- **select-window**: 窗口函数模板
- **insert-basic**: INSERT语句模板
- **update-basic**: UPDATE语句模板
- **delete-basic**: DELETE语句模板
- **create-table**: 创建表模板

### 🔧 智能格式化

高级编辑器提供智能SQL格式化功能：

**格式化前：**
```sql
select u.name,count(*) from users u join orders o on u.id=o.user_id where u.status='active' group by u.name having count(*)>5 order by count(*) desc;
```

**格式化后：**
```sql
SELECT u.name,
       COUNT(*)
FROM users u
JOIN orders o ON u.id = o.user_id
WHERE u.status = 'active'
GROUP BY u.name
HAVING COUNT(*) > 5
ORDER BY COUNT(*) DESC;
```

### 🔍 实时语法检查

- **错误检测**：未闭合的引号、括号不匹配
- **警告提示**：潜在的语法问题
- **悬浮提示**：鼠标悬停显示错误详情
- **错误标记**：红色波浪线标记错误位置

### 📊 查询复杂度分析

编辑器会自动分析SQL查询的复杂度：

- **Simple**: 基础查询，复杂度 ≤ 5
- **Medium**: 中等复杂度，包含JOIN、子查询等
- **Complex**: 高复杂度，多表关联、复杂逻辑

### ⌨️ 快捷键支持

| 快捷键 | 功能 |
|--------|------|
| `Ctrl + Enter` | 执行查询 |
| `Shift + Alt + F` | 格式化代码 |
| `Ctrl + /` | 注释/取消注释 |
| `Ctrl + D` | 选择下一个相同单词 |
| `Alt + ↑/↓` | 移动行 |
| `Shift + Alt + ↑/↓` | 复制行 |
| `Ctrl + Shift + K` | 删除行 |
| `F11` | 全屏模式 |

## 🔄 编辑器切换

### 自动切换
- 系统会自动检测浏览器兼容性
- 支持Monaco Editor的现代浏览器默认使用高级编辑器
- 不支持的浏览器自动回退到基础编辑器

### 手动切换
1. 在导航栏找到"高级编辑器"开关
2. 点击切换按钮
3. 系统会保存当前编辑内容并重新初始化编辑器
4. 用户偏好会保存到本地存储

### URL参数控制
在URL中添加参数强制使用基础编辑器：
```
http://localhost:8081/?editor=basic
```

## 🛠️ 使用技巧

### 1. 快速插入代码片段
1. 输入片段前缀，如 `select`
2. 从提示列表中选择对应的代码片段
3. 使用 `Tab` 键在占位符间跳转
4. 填写具体的表名、列名等信息

### 2. 多光标编辑
1. 按住 `Ctrl` 键点击多个位置
2. 或使用 `Ctrl + D` 选择相同单词
3. 同时编辑多个位置的内容

### 3. 列选择模式
1. 按住 `Shift + Alt` 键
2. 拖拽鼠标选择矩形区域
3. 可以同时编辑多行的相同列位置

### 4. 快速注释
1. 选择要注释的代码行
2. 使用 `Ctrl + /` 快速添加或移除注释
3. 支持单行和多行注释

### 5. 代码折叠
1. 点击行号左侧的折叠图标
2. 或使用 `Ctrl + Shift + [` 折叠代码块
3. 使用 `Ctrl + Shift + ]` 展开代码块

## 🔧 自定义配置

### 主题切换
高级编辑器支持多种主题：
- **vs-dark**: 深色主题（默认）
- **vs**: 浅色主题
- **hc-black**: 高对比度主题

### 编辑器设置
可以通过修改编辑器选项来自定义：
```javascript
{
    fontSize: 14,                    // 字体大小
    fontFamily: 'Monaco, monospace', // 字体族
    wordWrap: 'on',                 // 自动换行
    minimap: { enabled: false },    // 小地图
    lineNumbers: 'on',              // 行号显示
    folding: true,                  // 代码折叠
    renderWhitespace: 'selection'   // 空白字符显示
}
```

## 🚀 性能优化

### 大文件处理
- 高级编辑器对大型SQL文件进行了优化
- 支持虚拟滚动，处理数千行代码无压力
- 智能语法高亮，只渲染可见区域

### 内存管理
- 自动释放不使用的编辑器实例
- 智能缓存常用的语法规则
- 延迟加载非核心功能

## 🐛 故障排除

### 高级编辑器无法加载
1. 检查网络连接，确保能访问CDN
2. 检查浏览器控制台是否有错误信息
3. 尝试刷新页面或清除浏览器缓存
4. 如果问题持续，系统会自动回退到基础编辑器

### 智能提示不工作
1. 确保JavaScript没有被禁用
2. 检查是否有脚本错误阻止了功能加载
3. 尝试重新切换编辑器类型

### 格式化结果不理想
1. 检查SQL语法是否正确
2. 复杂的嵌套查询可能需要手动调整
3. 可以分段格式化复杂查询

## 📚 最佳实践

### 1. SQL编写规范
- 使用大写关键字提高可读性
- 适当使用缩进和换行
- 为复杂查询添加注释说明
- 使用有意义的表别名

### 2. 性能优化建议
- 避免使用 `SELECT *`，明确指定需要的列
- 在WHERE子句中使用索引列
- 合理使用JOIN，避免笛卡尔积
- 对大数据集使用LIMIT限制结果

### 3. 代码组织
- 将复杂查询分解为多个简单查询
- 使用CTE（公共表表达式）提高可读性
- 为重复使用的查询创建视图
- 定期备份重要的查询语句

## 🔮 未来规划

### 即将推出的功能
- 🔍 **查询执行计划分析**：可视化显示查询执行计划
- 📊 **性能监控**：实时监控查询执行时间和资源使用
- 🤖 **AI辅助编写**：基于机器学习的SQL建议
- 🔗 **数据库模式集成**：自动获取表结构和关系
- 📝 **查询历史管理**：保存和管理查询历史记录
- 🎨 **自定义主题**：支持用户自定义编辑器主题

### 长期目标
- 支持更多数据库类型（PostgreSQL、Oracle、SQL Server）
- 集成数据可视化工具
- 支持协作编辑功能
- 移动端原生应用

---

## 💬 反馈与支持

如果您在使用过程中遇到问题或有改进建议，请通过以下方式联系我们：

- 📧 邮箱：support@bi-web.com
- 🐛 问题反馈：[GitHub Issues](https://github.com/bojian69/bi-web/issues)
- 💡 功能建议：[Feature Requests](https://github.com/bojian69/bi-web/discussions)

感谢您使用bi-web数据分析平台！🎉